FROM node:17.4.0

# ARG NUXT_ENV_API_URL NUXT_ENV_SENTRY_DISABLED NUXT_ENV_SENTRY_DSN
# ENV NUXT_ENV_API_URL ${NUXT_ENV_API_URL}
# ENV NUXT_ENV_SENTRY_DISABLED ${NUXT_ENV_SENTRY_DISABLED}
# ENV NUXT_ENV_SENTRY_DSN ${NUXT_ENV_SENTRY_DSN}

ARG NODE_ENV=production

ARG CLIENT_PORT=4000

WORKDIR /app

COPY package.json .

RUN npm install

COPY . .

RUN npm run build

ENTRYPOINT ["bash", "entrypoint.sh"]

EXPOSE ${CLIENT_PORT}

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s CMD curl --fail 127.0.0.1:${CLIENT_PORT} > /dev/null 2>&1 || pkill node
